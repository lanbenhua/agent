!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Agent={})}(this,(function(t){"use strict";const e=(t,e,n)=>{try{return JSON.stringify(t,e,n)}catch(t){return""}};class n{constructor(t){this._contentType=t}marshal(t){return""===t||null==t||t instanceof FormData||t instanceof Blob||t instanceof ArrayBuffer||t instanceof URLSearchParams?t:"json"===this._contentType&&"string"!=typeof t?e(t):"form"===this._contentType&&function(t){if(!s(t))return!1;if(void 0===t.constructor)return!0;if(!s(t.constructor.prototype))return!1;if(!t.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1;return!0}(t)?Object.entries(t).reduce(((t,[e,n])=>o(n)?t:Array.isArray(n)?(n.forEach((n=>{o(n)||t.append(e,r(n))})),t):(t.append(e,r(n)),t)),new URLSearchParams).toString():t}}function o(t){return null==t}function r(t){return o(t)?"":"string"==typeof t?t:"number"==typeof t||"boolean"==typeof t?String(t):e(t)}
/*!
     * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
     *
     * Copyright (c) 2014-2017, Jon Schlinkert.
     * Released under the MIT License.
     */function s(t){return"[object Object]"===Object.prototype.toString.call(t)}class i{constructor(){this.handlers=[],this.handlers=[]}use(t,e,n){return this.handlers=this.handlers.concat({onFulfilled:t,onRejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}reject(t){this.handlers[t]&&(this.handlers[t]=null)}forEach(t){this.handlers.forEach(((e,n)=>{null!==e&&t(e,n)}))}}const l=window.fetch,a={json:"application/json; charset=utf-8",form:"application/x-www-form-urlencoded; charset=utf-8",formdata:void 0,buffer:"text/plain; charset=utf-8",text:"text/plain; charset=utf-8",blob:void 0};const c=t=>{const e=t.headers.get("content-type");return e?e.includes("application/json")?"json":e.includes("text/plain")||e.includes("text/html")||e.includes("application/xml")?"text":"json":"text"},u=(...t)=>{const e=/^(https?|file|wss?):\/\//;return t.filter(Boolean).map(String).reduce(((t,n)=>new RegExp(e).test(n)?n:t+"/"+n)).replace(new RegExp(/(?<!(https?|file|wss?):)\/\/+/,"gm"),"/")};function h(t,e){const o=new URLSearchParams(t),r=new n("form").marshal(e),s=new URLSearchParams("?"+r);return s.forEach(((t,e)=>{null!=t&&o.append(e,t)})),s.toString()}t.default=class{constructor(t,e){this._dafaultInit={timeout:2e4,includeAbort:!0},this._interceptors={request:new i,response:new i},this._base=t,this._init=e}get interceptors(){return this._interceptors}abort(t){var e;null===(e=this._abortController)||void 0===e||e.abort(t)}request(t){this.resolveInput(t);const e=this.resolveReqInit(t);return this.resolveTimeoutAutoAbort(e),this.handleInterceptors(e)}resolveInput(t){var e;let n=u(this._base||(null==t?void 0:t.base),t.input);if("GET"===(null===(e=null==t?void 0:t.method)||void 0===e?void 0:e.toUpperCase())&&(null==t?void 0:t.data)){const e=n.indexOf("?"),o=e<0?n:n.slice(0,n.indexOf("?")),r=h(e<0?"":n.slice(n.indexOf("?")),null==t?void 0:t.data);n=o+(r?`?${r}`:"")}t.url=n}resolveReqInit(t){const e={timeout:2e4,responseType:"json",method:"GET",credentials:"include"},o=Object.assign(Object.assign(Object.assign(Object.assign({},this._dafaultInit),e),this._init),t);o.method||(o.method="GET"),o.method=o.method.toUpperCase(),o.credentials||(o.credentials="include"),o.contentType||"GET"===o.method||(o.contentType="json"),o.responseType||(o.responseType="json");const r=(null==o?void 0:o.contentType)&&a[null==o?void 0:o.contentType],s=Object.assign({},r?{"Content-Type":r}:null);return o.headers=Object.assign(Object.assign(Object.assign({},null==e?void 0:e.headers),s),o.headers),"GET"===o.method||"HEAD"===o.method?o.body=void 0:o.body=null!==o.body&&void 0!==o.body?o.body:new n(null==o?void 0:o.contentType).marshal(o.data),o}resolveTimeoutAutoAbort(t){let e;const n=null==t?void 0:t.timeout;(n||!1!==(null==t?void 0:t.includeAbort)&&(null==t?void 0:t.includeAbort))&&!(null==t?void 0:t.signal)&&(e=new AbortController,this._abortController=e,t.signal=e.signal),n&&e&&(this._timer=setTimeout((()=>{null==e||e.abort()}),n))}clearAutoAbortTimeout(){this._timer&&(window.clearTimeout(this._timer),this._timer=null)}handleInterceptors(t){const e=[];let n=!0;this._interceptors.request.forEach((o=>{const{runWhen:r,onFulfilled:s,onRejected:i}=o;"function"==typeof r&&!1===r(t)||(n=n&&o.synchronous,e.unshift(s,i))}));const o=[];let r;if(this._interceptors.response.forEach((t=>o.unshift(t.onFulfilled,t.onRejected))),!n){let n=[this.dispatchFetch.bind(this),void 0];for(Array.prototype.unshift.apply(n,e),n=n.concat(o),r=Promise.resolve(t);n.length;){const t=n.shift(),e=n.shift();t&&(r=r.then(t,e))}return r}let s=t;for(;e.length;){const t=e.shift(),n=e.shift();try{t&&(s=t(s))}catch(t){n&&n(t);break}}let i=this.dispatchFetch(t);for(;o.length;){const t=o.shift(),e=o.shift();t&&(i=i.then(t,e))}return i}dispatchFetch(t){const e=this;let n;const o=t.url||t.input;return o?l(o,t).then((e=>{n=e;const o=(null==t?void 0:t.responseType)||c(e);return"json"===o?e.json():"buffer"===o?e.arrayBuffer():"text"===o?e.text():"blob"===o?e.blob():"form"===o||"formdata"===o?e.formData():e.json()})).then((o=>({url:n.url,data:o,ok:n.ok,status:n.status,statusText:n.statusText,headers:n.headers,__reqInit__:t,__fetch__:e,__response__:n}))).catch((t=>{throw e.clearAutoAbortTimeout(),t})):Promise.reject(new Error("Unexpected error: url must have a value and be a string, but null!"))}},Object.defineProperty(t,"__esModule",{value:!0})}));
